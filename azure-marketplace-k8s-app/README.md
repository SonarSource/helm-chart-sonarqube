# SonarQube Server - Azure Marketplace Bundle

This is an empty bundle that porter has created to get you started!

To run `cpa verify`: ensure that you bind the project root, not only the `azure-marketplace-k8s-app` folder. If you do, you will get an error like this:

```
root [ /data ]# cpa verify
CPA Version:  1.3.36
By using the Azure Kubernetes CNAB Packaging Application, you agree to the License contained in the application. You can view the License at ~/LICENSE.
We collect telemetry data, if you would like to opt out of data collection please use the --telemetryOptOut flag.
Correlation Id: 64d474b1-0a27-4c48-9a33-52f3338888ae
Manifest file validated, 0 total failure(s)

Manifest verification successful.
Helm chart validated, 1 total failure(s)

  The chart path provided to the helm validate package does not exist
2025/05/20 13:08:09
Correlation Id: 64d474b1-0a27-4c48-9a33-52f3338888ae, CPABuild: 1.3.36
2025/05/20 13:08:09 The chart path provided to the helm validate package does not exist
2025/05/20 13:08:09
For more info refer to the documentation here: https://aka.ms/K8sOfferHelmChart
panic: interface conversion: interface {} is nil, not map[string]interface {}

[...]
```

This is the correct command:

```
docker run -it -v /var/run/docker.sock:/var/run/docker.sock -v $(pwd)/..:/data --entrypoint "/bin/bash" mcr.microsoft.com/container-package-app:latest
```

Before running `cpa verify` inside the container, you need to remove any dependencies:

>   There were compressed subcharts in the path: /data/charts/sonarqube
> Please decompress the chart(s) and delete the tgz file from charts folder.

Simply `rm -rf charts/sonarqube/charts` is enough to get rid of this error. But you will need to re-build the dependencies before committing anything.

Bellow is the boilerplate; kinda useful reading.

# Contents

## porter.yaml

This is the porter manifest. See https://porter.sh/author-bundles/ for
details on every field and how to configure your bundle. This is a required
file.

## helpers.sh

This is a bash script where you can place helper functions that you can call
from your porter.yaml file.

## README.md

This explains the files created by `porter create`. It is not used by porter and
can be deleted.

## template.Dockerfile

This is a template Dockerfile for the bundle image. You can
customize it to use different base images, install tools and copy configuration
files. Porter will use it as a template and append lines to it for the mixin and to set
the CMD appropriately for the CNAB specification. You can delete this file if you don't
need it.

Add the following line to **porter.yaml** to enable the Dockerfile template:

```yaml
dockerfile: template.Dockerfile
```

By default, the Dockerfile template is disabled and Porter automatically copies
all of the files in the current directory into the bundle image. When
you use a custom Dockerfile template, you must manually copy files into the bundle
using COPY statements in the Dockerfile template.

## .gitignore

This is a default file that we provide to help remind you which files are
generated by Porter, and shouldn't be committed to source control. You can
delete it if you don't need it.

## .dockerignore

This is a default file that controls which files are copied into the bundle
image by default. You can delete it if you don't need it.
